from functools import lru_cache
import re

from tree_plus_src import debug_print

_isabelle_symbols = {
    "zero": "ğŸ¬",
    "one": "ğŸ­",
    "two": "ğŸ®",
    "three": "ğŸ¯",
    "four": "ğŸ°",
    "five": "ğŸ±",
    "six": "ğŸ²",
    "seven": "ğŸ³",
    "eight": "ğŸ´",
    "nine": "ğŸµ",
    "A": "ğ’œ",
    "B": "â„¬",
    "C": "ğ’",
    "D": "ğ’Ÿ",
    "E": "â„°",
    "F": "â„±",
    "G": "ğ’¢",
    "H": "â„‹",
    "I": "â„",
    "J": "ğ’¥",
    "K": "ğ’¦",
    "L": "â„’",
    "M": "â„³",
    "N": "ğ’©",
    "O": "ğ’ª",
    "P": "ğ’«",
    "Q": "ğ’¬",
    "R": "â„›",
    "S": "ğ’®",
    "T": "ğ’¯",
    "U": "ğ’°",
    "V": "ğ’±",
    "W": "ğ’²",
    "X": "ğ’³",
    "Y": "ğ’´",
    "Z": "ğ’µ",
    "a": "ğ–º",
    "b": "ğ–»",
    "c": "ğ–¼",
    "d": "ğ–½",
    "e": "ğ–¾",
    "f": "ğ–¿",
    "g": "ğ—€",
    "h": "ğ—",
    "i": "ğ—‚",
    "j": "ğ—ƒ",
    "k": "ğ—„",
    "l": "ğ—…",
    "m": "ğ—†",
    "n": "ğ—‡",
    "o": "ğ—ˆ",
    "p": "ğ—‰",
    "q": "ğ—Š",
    "r": "ğ—‹",
    "s": "ğ—Œ",
    "t": "ğ—",
    "u": "ğ—",
    "v": "ğ—",
    "w": "ğ—",
    "x": "ğ—‘",
    "y": "ğ—’",
    "z": "ğ—“",
    "AA": "ğ”„",
    "BB": "ğ”…",
    "CC": "â„­",
    "DD": "ğ”‡",
    "EE": "ğ”ˆ",
    "FF": "ğ”‰",
    "GG": "ğ”Š",
    "HH": "â„Œ",
    "II": "â„‘",
    "JJ": "ğ”",
    "KK": "ğ”",
    "LL": "ğ”",
    "MM": "ğ”",
    "NN": "ğ”‘",
    "OO": "ğ”’",
    "PP": "ğ”“",
    "QQ": "ğ””",
    "RR": "â„œ",
    "SS": "ğ”–",
    "TT": "ğ”—",
    "UU": "ğ”˜",
    "VV": "ğ”™",
    "WW": "ğ”š",
    "XX": "ğ”›",
    "YY": "ğ”œ",
    "ZZ": "â„¨",
    "aa": "ğ”",
    "bb": "ğ”Ÿ",
    "cc": "ğ” ",
    "dd": "ğ”¡",
    "ee": "ğ”¢",
    "ff": "ğ”£",
    "gg": "ğ”¤",
    "hh": "ğ”¥",
    "ii": "ğ”¦",
    "jj": "ğ”§",
    "kk": "ğ”¨",
    "ll": "ğ”©",
    "mm": "ğ”ª",
    "nn": "ğ”«",
    "oo": "ğ”¬",
    "pp": "ğ”­",
    "qq": "ğ”®",
    "rr": "ğ”¯",
    "ss": "ğ”°",
    "tt": "ğ”±",
    "uu": "ğ”²",
    "vv": "ğ”³",
    "ww": "ğ”´",
    "xx": "ğ”µ",
    "yy": "ğ”¶",
    "zz": "ğ”·",
    "alpha": "Î±",
    "beta": "Î²",
    "gamma": "Î³",
    "delta": "Î´",
    "epsilon": "Îµ",
    "zeta": "Î¶",
    "eta": "Î·",
    "theta": "Î¸",
    "iota": "Î¹",
    "kappa": "Îº",
    "lambda": "Î»",
    "mu": "Î¼",
    "nu": "Î½",
    "xi": "Î¾",
    "pi": "Ï€",
    "rho": "Ï",
    "sigma": "Ïƒ",
    "tau": "Ï„",
    "upsilon": "Ï…",
    "phi": "Ï†",
    "chi": "Ï‡",
    "psi": "Ïˆ",
    "omega": "Ï‰",
    "Gamma": "Î“",
    "Delta": "Î”",
    "Theta": "Î˜",
    "Lambda": "Î›",
    "Xi": "Î",
    "Pi": "Î ",
    "Sigma": "Î£",
    "Upsilon": "Î¥",
    "Phi": "Î¦",
    "Psi": "Î¨",
    "Omega": "Î©",
    "bbbA": "ğ”¸",
    "bool": "ğ”¹",
    "complex": "â„‚",
    "bbbD": "ğ”»",
    "bbbE": "ğ”¼",
    "bbbF": "ğ”½",
    "bbbG": "ğ”¾",
    "bbbH": "â„",
    "bbbI": "ğ•€",
    "bbbJ": "ğ•",
    "bbbK": "ğ•‚",
    "bbbL": "ğ•ƒ",
    "bbbM": "ğ•„",
    "nat": "â„•",
    "bbbO": "ğ•†",
    "bbbP": "â„™",
    "rat": "â„š",
    "real": "â„",
    "bbbS": "ğ•Š",
    "bbbT": "ğ•‹",
    "bbbU": "ğ•Œ",
    "bbbV": "ğ•",
    "bbbW": "ğ•",
    "bbbX": "ğ•",
    "bbbY": "ğ•",
    "int": "â„¤",
    "leftarrow": "â†",
    "longleftarrow": "âŸµ",
    "longlongleftarrow": "â¤",
    "longlonglongleftarrow": "â‡ ",
    "rightarrow": "â†’",
    "longrightarrow": "âŸ¶ ",
    "longlongrightarrow": "â¤",
    "longlonglongrightarrow": "â‡¢",
    "Leftarrow": "â‡",
    "Longleftarrow": "âŸ¸",
    "Lleftarrow": "â‡š",
    "Rightarrow": "â‡’",
    "Longrightarrow": "âŸ¹ ",
    "Rrightarrow": "â‡›",
    "leftrightarrow": "â†”",
    "longleftrightarrow": "âŸ·",
    "Leftrightarrow": "â‡”",
    "Longleftrightarrow": "âŸº",
    "mapsto": "â†¦",
    "longmapsto": "âŸ¼",
    "midarrow": "â”€",
    "Midarrow": "â•",
    "hookleftarrow": "â†©",
    "hookrightarrow": "â†ª",
    "leftharpoondown": "â†½",
    "rightharpoondown": "â‡",
    "leftharpoonup": "â†¼",
    "rightharpoonup": "â‡€",
    "rightleftharpoons": "â‡Œ",
    "leadsto": "â†",
    "downharpoonleft": "â‡ƒ",
    "downharpoonright": "â‡‚",
    "upharpoonleft": "â†¿",
    "restriction": "â†¾",
    "Colon": "âˆ·",
    "up": "â†‘",
    "Up": "â‡‘",
    "down": "â†“",
    "Down": "â‡“",
    "updown": "â†•",
    "Updown": "â‡•",
    "langle": "âŸ¨",
    "rangle": "âŸ©",
    "llangle": "âŸª",
    "rrangle": "âŸ«",
    "lceil": "âŒˆ",
    "rceil": "âŒ‰",
    "lfloor": "âŒŠ",
    "rfloor": "âŒ‹",
    "lparr": "â¦‡",
    "rparr": "â¦ˆ",
    "lbrakk": "âŸ¦",
    "rbrakk": "âŸ§",
    "lbrace": "â¦ƒ",
    "rbrace": "â¦„",
    "lblot": "â¦‰",
    "rblot": "â¦Š",
    "guillemotleft": "Â«",
    "guillemotright": "Â»",
    "bottom": "âŠ¥",
    "top": "âŠ¤",
    "and": "âˆ§",
    "And": "â‹€",
    "or": "âˆ¨",
    "Or": "â‹",
    "forall": "âˆ€",
    "exists": "âˆƒ",
    "nexists": "âˆ„",
    "not": "Â¬",
    "circle": "â—‹",
    "box": "â–¡",
    "diamond": "â—‡",
    "diamondop": "â‹„",
    "turnstile": "âŠ¢",
    "Turnstile": "âŠ¨",
    "tturnstile": "âŠ©",
    "TTurnstile": "âŠ«",
    "stileturn": "âŠ£",
    "surd": "âˆš",
    "le": "â‰¤",
    "ge": "â‰¥",
    "lless": "â‰ª",
    "ggreater": "â‰«",
    "lesssim": "â‰²",
    "greatersim": "â‰³",
    "lessapprox": "âª…",
    "greaterapprox": "âª†",
    "in": "âˆˆ",
    "notin": "âˆ‰",
    "subset": "âŠ‚",
    "supset": "âŠƒ",
    "subseteq": "âŠ†",
    "supseteq": "âŠ‡",
    "sqsubset": "âŠ",
    "sqsupset": "âŠ",
    "sqsubseteq": "âŠ‘",
    "sqsupseteq": "âŠ’",
    "inter": "âˆ©",
    "Inter": "â‹‚",
    "union": "âˆª",
    "Union": "â‹ƒ",
    "squnion": "âŠ”",
    "Squnion": "â¨†",
    "sqinter": "âŠ“",
    "Sqinter": "â¨…",
    "setminus": "âˆ–",
    "propto": "âˆ",
    "uplus": "âŠ",
    "Uplus": "â¨„",
    "noteq": "â‰ ",
    "sim": "âˆ¼",
    "doteq": "â‰",
    "simeq": "â‰ƒ",
    "approx": "â‰ˆ",
    "asymp": "â‰",
    "cong": "â‰…",
    "smile": "âŒ£",
    "equiv": "â‰¡",
    "frown": "âŒ¢",
    "Join": "â‹ˆ",
    "bowtie": "â¨",
    "prec": "â‰º",
    "succ": "â‰»",
    "preceq": "â‰¼",
    "succeq": "â‰½",
    "parallel": "âˆ¥",
    "Parallel": "â€–",
    "interleave": "â«´",
    "sslash": "â«½",
    "bar": "Â¦",
    "bbar": "â«¿",
    "plusminus": "Â±",
    "minusplus": "âˆ“",
    "times": "Ã—",
    "div": "Ã·",
    "cdot": "â‹…",
    "star": "â‹†",
    "bullet": "âˆ™",
    "circ": "âˆ˜",
    "dagger": "â€ ",
    "ddagger": "â€¡",
    "lhd": "âŠ²",
    "rhd": "âŠ³",
    "unlhd": "âŠ´",
    "unrhd": "âŠµ",
    "triangleleft": "â—ƒ",
    "triangleright": "â–¹",
    "triangle": "â–³",
    "triangleq": "â‰œ",
    "oplus": "âŠ•",
    "Oplus": "â¨",
    "otimes": "âŠ—",
    "Otimes": "â¨‚",
    "odot": "âŠ™",
    "Odot": "â¨€",
    "ominus": "âŠ–",
    "oslash": "âŠ˜",
    "dots": "â€¦",
    "cdots": "â‹¯",
    "Sum": "âˆ‘",
    "Prod": "âˆ",
    "Coprod": "âˆ",
    "infinity": "âˆ",
    "integral": "âˆ«",
    "ointegral": "âˆ®",
    "clubsuit": "â™£",
    "diamondsuit": "â™¢",
    "heartsuit": "â™¡",
    "spadesuit": "â™ ",
    "aleph": "â„µ",
    "emptyset": "âˆ…",
    "nabla": "âˆ‡",
    "partial": "âˆ‚",
    "flat": "â™­",
    "natural": "â™®",
    "sharp": "â™¯",
    "angle": "âˆ ",
    "copyright": "Â©",
    "registered": "Â®",
    "hyphen": "â€",
    "inverse": "Â¯",
    "sqdot": "Â·",
    "onequarter": "Â¼",
    "onehalf": "Â½",
    "threequarters": "Â¾",
    "ordfeminine": "Âª",
    "ordmasculine": "Âº",
    "section": "Â§",
    "paragraph": "Â¶",
    "exclamdown": "Â¡",
    "questiondown": "Â¿",
    "euro": "â‚¬",
    "pounds": "Â£",
    "yen": "Â¥",
    "cent": "Â¢",
    "currency": "Â¤",
    "degree": "Â°",
    "amalg": "â¨¿",
    "mho": "â„§",
    "lozenge": "â—Š",
    "wp": "â„˜",
    "wrong": "â‰€",
    "acute": "Â´",
    "index": "Ä±",
    "dieresis": "Â¨",
    "cedilla": "Â¸",
    "hungarumlaut": "Ë",
    "bind": "â¤œ",
    "then": "âª¢",
    "some": "Ïµ",
    "Zcomp": "â¨¾",
    "Zinj": "â†£",
    "Zpinj": "â¤”",
    "Zfinj": "â¤•",
    "Zsurj": "â† ",
    "Zpsurj": "â¤€",
    "Zbij": "â¤–",
    "Zpfun": "â‡¸",
    "Zffun": "â‡»",
    "Zdres": "â—",
    "Zndres": "â©¤",
    "Zrres": "â–·",
    "Znrres": "â©¥",
    "Zspot": "â¦",
    "Zsemi": "â¨Ÿ",
    "Zproject": "â¨¡",
    "Ztypecolon": "â¦‚",
    "Zhide": "â§¹",
    "Zcat": "â€",
    "Zinbag": "â‹¿",
    "Zprime": "â€²",
    "hole": "âŒ‘",
    "newline": "â",
    "comment": "â€•",
    "^cancel": "âŒ¦",
    "^marker": "âœ",
    "checkmark": "âœ“",
    "crossmark": "âœ—",
    "open": "â€¹",
    "close": "â€º",
    "^here": "âŒ‚",
    "^undefined": "â–",
    "^noindent": "â‡¤",
    "^smallskip": "â”ˆ",
    "^medskip": "â”‰",
    "^bigskip": "â”",
    "^item": "â–ª",
    "^enum": "â–¸",
    "^descr": "â§",
    "^footnote": "â‹",
    "^verbatim": "â–©",
    "^theory_text": "â¬š",
    "^emph": "âˆ—",
    "^bold": "â™",
    "^sub": "â‡©",
    "^sup": "â‡§",
    "^bsub": "â‡˜",
    "^esub": "â‡™",
    "^bsup": "â‡—",
    "^esup": "â‡–",
    "^file": "ğŸ—",
    "^dir": "ğŸ—€",
    "^url": "ğŸŒ",
    "^doc": "ğŸ““",
    "^action": "â˜›",
}

_pattern = re.compile(
    r"\\<(" + "|".join(re.escape(key) for key in _isabelle_symbols.keys()) + r")>"
)


@lru_cache
def _replace_symbol(match: re.Match) -> str:
    sense = match.group(1)
    referent = _isabelle_symbols.get(sense, match.group())
    debug_print(f"_replace_isabelle_symbol: '{sense}': '{referent}'")
    return referent


def replace_isabelle_symbols(content: str) -> str:
    return _pattern.sub(_replace_symbol, content)
